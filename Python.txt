import tkinter as tk
from tkinter import messagebox
import serial
import time

#------------Funções----------------#
modo_selecionado = None
cooldown = None
arduino = None

def verificar_conexao_arduino():
    global arduino
    try:
        arduino = serial.Serial('COM3', 9600, timeout=1)
        time.sleep(2)
        messagebox.showinfo("Conexão", "Dispositivo Conectado")
    except serial.SerialException:
        messagebox.showerror("Erro", "Nenhum dispositivo conectado")

def enviar_para_arduino(valor):
    if arduino is None or not arduino.is_open:
        return "Erro: Nenhuma conexão com o Arduino."
    
    arduino.write((valor + "\n").encode())
    resposta = arduino.readline().decode().strip()
    return resposta

def trocar_modo(nm):
    global cooldown, modo_selecionado

    if cooldown is not None:
        tempo_restante = 60 - int(time.time() - cooldown)
        if tempo_restante > 0:
            messagebox.showwarning(
                "AAAAA",
                f"Tente Novamente em {tempo_restante} segundos."
            )
            return

    modo_selecionado = nm
    cooldown = time.time()

    resposta = enviar_para_arduino(nm)
    messagebox.showinfo("Modo Alterado", f"Modo alterado para {nm}. Resposta do Arduino: {resposta}")

def checar_atividade():
    global modo_selecionado
    if modo_selecionado is None:
        messagebox.showwarning("Modo", "Selecione um modo")
        return
    resposta = enviar_para_arduino(modo_selecionado.get())
    messagebox.showinfo("Arduino", resposta)

#----------------INTERFACE-----------------#
janela = tk.Tk()
janela.title("Janela Generical")
janela.geometry("500x500")

modo_selecionado = tk.StringVar()

# Radiobuttons para selecionar o modo
check_açai = tk.Radiobutton(janela, text="Açai", variable=modo_selecionado, value="Açai", command=lambda: trocar_modo("Açai"))
check_sorvete = tk.Radiobutton(janela, text="Sorvete", variable=modo_selecionado, value="Sorvete", command=lambda: trocar_modo("Sorvete"))
check_bebidas = tk.Radiobutton(janela, text="Bebidas", variable=modo_selecionado, value="Bebidas", command=lambda: trocar_modo("Bebidas"))

check_açai.pack(pady=5)
check_sorvete.pack(pady=5)
check_bebidas.pack(pady=5)

#------------------Botões---------------------------#
btn_submit = tk.Button(janela, text="Submit", width=25, command=checar_atividade)
btn_submit.pack(pady=10)

btn_conectar = tk.Button(janela, text="Verificar Conexão", width=25, command=verificar_conexao_arduino)
btn_conectar.pack(pady=10)

# Inicia o loop da interface gráfica
janela.mainloop()
